import discord
import youtube_dl
from discord.utils import get
from discord.ext import commands
import random
client= commands.Bot(command_prefix = '?')
TOKEN='Njk1NTgwODMxNDk4MTA4OTc5.XoclgQ.zgqOsqxYqNfkI_tpF334npjMmJ8'

players = {}

@client.event
async def on_ready():
    print('Bejelentkezve {0.user} néven!'.format(client))
    print('Hi Mr. Török!')
    print('|---------------------------|')
    print()

@client.command(pass_context=True)
async def gyerebe(ctx):
    """feljövök a hangra"""
    global voice
    cc=ctx.message.author.voice
    if cc==None:
        channel=get(ctx.message.guild.channels, id=695576958133600269)
    else:
        channel = ctx.message.author.voice.channel
    voice = get(client.voice_clients, guild=ctx.guild)
    if voice and voice.is_connected():
        await ctx.send(f"Már fent vagyok bazdmeg")
    else:
        voice = await channel.connect()
        await ctx.send(f"Csatlakoztam a(z) {channel}-hoz")
        print(f"Csatlakozva a(z) {channel}-ra")
@client.command(pass_context=True)
async def menjinnen(ctx):
    """lemegyek a hangról"""
    voice = get(client.voice_clients, guild=ctx.guild)
    if voice and voice.is_connected():
        await voice.disconnect()
        await ctx.send(f"Lecsatlakoztam")
        print(f"Lecsatlakozva")
    else:
        await ctx.send(f"Le vagyok csatlakozva he")

@client.command(pass_context=True, no_pm=True)
async def muzsikat(self, ctx, *, song:str):
      """Lejátszik egy zenét.
      """
      state = self.get_voice_state(ctx.message.guild)
      opts = {
          'default_search': 'auto',
          'quiet': True,
      }

      if state.voice is None:
          success = await ctx.invoke(self.summon)
          await self.bot.say("Loading the song please be patient..")
          if not success:
              return

      try:
          player = await state.voice.create_ytdl_player(song, ytdl_options=opts, after=state.toggle_next)
      except Exception as e:
          fmt = 'An error occurred while processing this request: ```py\n{}: {}\n```'
          await self.bot.send_message(ctx.message.channel, fmt.format(type(e).__name__, e))
      else:
          player.volume = 0.6
          entry = VoiceEntry(ctx.message, player)
          await self.bot.say('Enqueued ' + str(entry))
          await state.songs.put(entry)


client.run(TOKEN)
